<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    
    <script type="text/javascript" src="cordova.js"></script>

    <style type="text/css">
    #map_canvas {
      position: absolute;
      left:-50px;
      top: -50px;
      right: -50px;
      bottom: -50px;
    }
    </style>
    <script >
    document.addEventListener("deviceready", function() 
	{
		// Get the current device location "without map"
		var option = {
			maximumAge: 10000,
			timeout: 10000,
			enableHighAccuracy: true // use GPS as much as possible
		};
		plugin.google.maps.LocationService.getMyLocation(option, function(location) 
		{
			// Create a map with the device location
			var mapDiv = document.getElementById('map_canvas');
			var map = plugin.google.maps.Map.getMap(mapDiv, 
			{
				'camera': 
				{
					target: location.latLng,
					zoom: 16
				}
			  });

			map.addEventListener(plugin.google.maps.event.MAP_READY, function() 
			{
				// Add a marker
				var text = ["Current your location:\n",
				"latitude:" + location.latLng.lat.toFixed(3),
				"longitude:" + location.latLng.lng.toFixed(3),
				"speed:" + location.speed,
				"time:" + location.time,
				"bearing:" + location.bearing].join("\n");

				var marker = map.addMarker(
				{
					title: text,
					position: location.latLng
				}, function(marker) 
				{
				  marker.showInfoWindow();
				});
				var watchID = navigator.geolocation.watchPosition(onSuccess, onError, option);
			});
			
			
		});
		function onSuccess(position) 
		{
			var lat = precisionRound(position.coords.latitude, 5);//latitude actuelle
			var longi = precisionRound(position.coords.longitude, 5 );//longitude actuelle
			
			alert("lat: " + lat + " - longi: " + longi);
			
			$.ajax({
				url : 'http://www.colisclub.fr/application/ajax.php',
				type : 'GET', // Le type de la requête HTTP, ici devenu POST
				data:'lat=' + lat +
					'&longi=' + longi,
				dataType : 'html',
				success: function (html) 
				{
					alert("ca marche");
				},
				error: function(resultat, statut, erreur) 
				{
					navigator.notification.alert("erreur", alertCallback, "Géolocalisation", "Fermer");
				}
			});		
		}

		// onError Callback receives a PositionError object
		function onError(error) {
			alert('code: '    + error.code    + '\n' +
				  'message: ' + error.message + '\n');
		}
		
		function alertCallback()
		{
			//pour l'alert de cordova (obligatoire d avoir une fonction mais rien a y faire perso :) )
		}
		function precisionRound(number, precision) 
		{
			var factor = Math.pow(10, precision);
			return Math.round(number * factor) / factor;
		}

		// Options: throw an error if no update is received every 30 seconds.
		//
		
		
	});
	
	
    </script>
</head>

<body>
	<h1>test</h1>

    <div id="map_canvas">
    </div>
	
	<input type="hidden" name="old_longitude">
	<input type="hidden" name="old_latitude">
	
	<script type="text/javascript" src="jquery.js"></script>

</body>

</html>